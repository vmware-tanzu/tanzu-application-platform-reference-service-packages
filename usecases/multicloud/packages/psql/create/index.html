<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Site for examples related to service packages implementing service binding spec to be consumed by VMware Tanzu Application Platform"><link href=https://vmware-tanzu.github.io/tanzu-application-platform-reference-service-packages/usecases/multicloud/packages/psql/create/ rel=canonical><link href=../ rel=prev><link href=../../../../../crossplane/ rel=next><link rel=icon href=../../../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.4.2, mkdocs-material-9.0.11"><title>Creating the Postgresql Multicloud Crossplane package - Tanzu Application Platform Reference Service Packages</title><link rel=stylesheet href=../../../../../assets/stylesheets/main.0d440cfe.min.css><link rel=stylesheet href=../../../../../assets/stylesheets/palette.2505c338.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Metropolis,Avenir+Next,Helvetica+Neue,Arial,sans-serif:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Metropolis,Avenir Next,Helvetica Neue,Arial,sans-serif";--md-code-font:"JetBrains Mono"}</style><link rel=stylesheet href=../../../../../assets/extra.css><script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary data-md-color-accent> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#why-multicloud class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-component=outdated hidden> </div> <header class="md-header md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../../../.. title="Tanzu Application Platform Reference Service Packages" class="md-header__button md-logo" aria-label="Tanzu Application Platform Reference Service Packages" data-md-component=logo> <img src=../../../../../assets/vm-logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Tanzu Application Platform Reference Service Packages </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Creating the Postgresql Multicloud Crossplane package </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary data-md-color-accent aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/vmware-tanzu/tanzu-application-platform-reference-service-packages title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> vmware-tanzu/tanzu-application-platform-reference-service-packages </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../../../.. class=md-tabs__link> HOME </a> </li> <li class=md-tabs__item> <a href=../../../../aws/packages/elasticache/ack/ class="md-tabs__link md-tabs__link--active"> Use cases </a> </li> <li class=md-tabs__item> <a href=../../../../../crossplane/ class=md-tabs__link> Crossplane </a> </li> <li class=md-tabs__item> <a href=../../../../../ci/ class=md-tabs__link> CI </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../../../.. title="Tanzu Application Platform Reference Service Packages" class="md-nav__button md-logo" aria-label="Tanzu Application Platform Reference Service Packages" data-md-component=logo> <img src=../../../../../assets/vm-logo.png alt=logo> </a> Tanzu Application Platform Reference Service Packages </label> <div class=md-nav__source> <a href=https://github.com/vmware-tanzu/tanzu-application-platform-reference-service-packages title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> vmware-tanzu/tanzu-application-platform-reference-service-packages </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../.. class=md-nav__link> HOME </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2 checked> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> Use cases <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=true> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Use cases </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_1> <label class=md-nav__link for=__nav_2_1 id=__nav_2_1_label tabindex=0> AWS <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_1_label aria-expanded=false> <label class=md-nav__title for=__nav_2_1> <span class="md-nav__icon md-icon"></span> AWS </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_1_1> <label class=md-nav__link for=__nav_2_1_1 id=__nav_2_1_1_label tabindex=0> Packages <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_2_1_1_label aria-expanded=false> <label class=md-nav__title for=__nav_2_1_1> <span class="md-nav__icon md-icon"></span> Packages </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_1_1_1> <label class=md-nav__link for=__nav_2_1_1_1 id=__nav_2_1_1_1_label tabindex=0> Elasticache with ACK <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_2_1_1_1_label aria-expanded=false> <label class=md-nav__title for=__nav_2_1_1_1> <span class="md-nav__icon md-icon"></span> Elasticache with ACK </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../aws/packages/elasticache/ack/ class=md-nav__link> Consuming AWS Elasticache with ACK </a> </li> <li class=md-nav__item> <a href=../../../../aws/packages/elasticache/ack/manual/ class=md-nav__link> Creating AWS Elasticache Instances manually using kubectl (experimental) </a> </li> <li class=md-nav__item> <a href=../../../../aws/packages/elasticache/ack/package/ class=md-nav__link> Creating AWS Elasticache instances by using a Carvel package (experimental) </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_1_2> <label class=md-nav__link for=__nav_2_1_2 id=__nav_2_1_2_label tabindex=0> Prerequisites <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_2_1_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2_1_2> <span class="md-nav__icon md-icon"></span> Prerequisites </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../aws/prerequisites/ class=md-nav__link> AWS prerequisites </a> </li> <li class=md-nav__item> <a href=../../../../aws/prerequisites/eks/ class=md-nav__link> Create an EKS cluster with EBS CSI driver </a> </li> <li class=md-nav__item> <a href=../../../../aws/prerequisites/ack/ class=md-nav__link> Install the AWS Controllers for Kubernetes (ACK) </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2> <label class=md-nav__link for=__nav_2_2 id=__nav_2_2_label tabindex=0> Azure <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2> <span class="md-nav__icon md-icon"></span> Azure </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2_1> <label class=md-nav__link for=__nav_2_2_1 id=__nav_2_2_1_label tabindex=0> Packages <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_2_2_1_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2_1> <span class="md-nav__icon md-icon"></span> Packages </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2_1_1> <label class=md-nav__link for=__nav_2_2_1_1 id=__nav_2_2_1_1_label tabindex=0> MongoDB with Crossplane <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_2_2_1_1_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2_1_1> <span class="md-nav__icon md-icon"></span> MongoDB with Crossplane </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../azure/packages/mongodb/crossplane/ class=md-nav__link> Consume MongoDB via Crossplane </a> </li> <li class=md-nav__item> <a href=../../../../azure/packages/mongodb/crossplane/consume-instance/ class=md-nav__link> Via Crossplane Instances </a> </li> <li class=md-nav__item> <a href=../../../../azure/packages/mongodb/crossplane/consume-package/ class=md-nav__link> Via Crossplane Package </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2_2> <label class=md-nav__link for=__nav_2_2_2 id=__nav_2_2_2_label tabindex=0> Prerequisites <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_2_2_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2_2> <span class="md-nav__icon md-icon"></span> Prerequisites </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../azure/prerequisites/ class=md-nav__link> Azure Packages Prerequisites </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_3 checked> <label class=md-nav__link for=__nav_2_3 id=__nav_2_3_label tabindex=0> Multicloud <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_3_label aria-expanded=true> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> Multicloud </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_3_1 checked> <label class=md-nav__link for=__nav_2_3_1 id=__nav_2_3_1_label tabindex=0> Packages <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_2_3_1_label aria-expanded=true> <label class=md-nav__title for=__nav_2_3_1> <span class="md-nav__icon md-icon"></span> Packages </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_3_1_1 checked> <label class=md-nav__link for=__nav_2_3_1_1 id=__nav_2_3_1_1_label tabindex=0> Postgresql with Crossplane <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_2_3_1_1_label aria-expanded=true> <label class=md-nav__title for=__nav_2_3_1_1> <span class="md-nav__icon md-icon"></span> Postgresql with Crossplane </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../ class=md-nav__link> Consuming Postgresql Multicloud </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Creating the Postgresql Multicloud Crossplane package <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Creating the Postgresql Multicloud Crossplane package </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#why-multicloud class=md-nav__link> Why Multicloud </a> </li> <li class=md-nav__item> <a href=#why-this-package class=md-nav__link> Why This Package </a> </li> <li class=md-nav__item> <a href=#crossplane-xrd-compositions class=md-nav__link> Crossplane XRD &amp; Compositions </a> <nav class=md-nav aria-label="Crossplane XRD & Compositions"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#solving-for-random-password class=md-nav__link> Solving For Random Password </a> </li> <li class=md-nav__item> <a href=#creating-a-complete-connectiondetails-secret class=md-nav__link> Creating a complete ConnectionDetails secret </a> </li> <li class=md-nav__item> <a href=#solve-for-stk-metadata class=md-nav__link> Solve For STK Metadata </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#manage-compositions-with-ytt class=md-nav__link> Manage Compositions with YTT </a> <nav class=md-nav aria-label="Manage Compositions with YTT"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#templating class=md-nav__link> Templating </a> </li> <li class=md-nav__item> <a href=#schema class=md-nav__link> Schema </a> </li> <li class=md-nav__item> <a href=#solving-for-re-usable-snippets class=md-nav__link> Solving For Re-usable Snippets </a> <nav class=md-nav aria-label="Solving For Re-usable Snippets"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#aws-private-example class=md-nav__link> AWS Private Example </a> </li> <li class=md-nav__item> <a href=#aws-public-example class=md-nav__link> AWS Public Example </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> Crossplane <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Crossplane </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../crossplane/ class=md-nav__link> Install Crossplane </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2> <label class=md-nav__link for=__nav_3_2 id=__nav_3_2_label tabindex=0> Providers <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> Providers </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../crossplane/providers/aws/ class=md-nav__link> UXP AWS provider </a> </li> <li class=md-nav__item> <a href=../../../../../crossplane/providers/azure/ class=md-nav__link> UXP Azure provider </a> </li> <li class=md-nav__item> <a href=../../../../../crossplane/providers/terraform/ class=md-nav__link> UXP Terraform provider </a> </li> <li class=md-nav__item> <a href=../../../../../crossplane/providers/helm/ class=md-nav__link> Helm provider </a> </li> <li class=md-nav__item> <a href=../../../../../crossplane/providers/kubernetes/ class=md-nav__link> Kubernetes provider </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> CI <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> CI </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../ci/ class=md-nav__link> Continuous Integration </a> </li> <li class=md-nav__item> <a href=../../../../../ci/documentation/ class=md-nav__link> Documentation </a> </li> <li class=md-nav__item> <a href=../../../../../ci/carvel-crossplane-packages/ class=md-nav__link> Carvel and Crossplane packages </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#why-multicloud class=md-nav__link> Why Multicloud </a> </li> <li class=md-nav__item> <a href=#why-this-package class=md-nav__link> Why This Package </a> </li> <li class=md-nav__item> <a href=#crossplane-xrd-compositions class=md-nav__link> Crossplane XRD &amp; Compositions </a> <nav class=md-nav aria-label="Crossplane XRD & Compositions"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#solving-for-random-password class=md-nav__link> Solving For Random Password </a> </li> <li class=md-nav__item> <a href=#creating-a-complete-connectiondetails-secret class=md-nav__link> Creating a complete ConnectionDetails secret </a> </li> <li class=md-nav__item> <a href=#solve-for-stk-metadata class=md-nav__link> Solve For STK Metadata </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#manage-compositions-with-ytt class=md-nav__link> Manage Compositions with YTT </a> <nav class=md-nav aria-label="Manage Compositions with YTT"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#templating class=md-nav__link> Templating </a> </li> <li class=md-nav__item> <a href=#schema class=md-nav__link> Schema </a> </li> <li class=md-nav__item> <a href=#solving-for-re-usable-snippets class=md-nav__link> Solving For Re-usable Snippets </a> <nav class=md-nav aria-label="Solving For Re-usable Snippets"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#aws-private-example class=md-nav__link> AWS Private Example </a> </li> <li class=md-nav__item> <a href=#aws-public-example class=md-nav__link> AWS Public Example </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1>Creating the Postgresql Multicloud Crossplane package</h1> <h2 id=why-multicloud>Why Multicloud<a class=headerlink href=#why-multicloud title="Permanent link">&para;</a></h2> <p>There are various reasons why companies are running applications in multiple clouds. We count data centers as local or private clouds.</p> <p>It is increasingly common for companies to run Kubernetes clusters in multiple locations - some clusters in the data center and others in AWS, for example.</p> <p>When (service) consumers do not care about the specific performance parameters of a database, you can simplify onboarding and relocation pain by providing a generic API.</p> <p>This package is an example of such a generic API. It holds as long as the consumers want <em>a database</em> and there is no need (yet) to fine-tune it.</p> <p>Good examples are PoCs, preview environments, or applications where the performance bottleneck lies elsewhere.</p> <h2 id=why-this-package>Why This Package<a class=headerlink href=#why-this-package title="Permanent link">&para;</a></h2> <p>There are several contributing factors as to why this package exists.</p> <ul> <li><strong>Multicloud Messaging</strong>: VMware is going big on multicloud. We wanted a package that shows how to leverage the Tanzu Application Platform (TAP) and other technologies (such as Crossplane) across multiple cloud environments.</li> <li><strong>Power of YTT</strong>: We are proud of our Carvel tool suite. We want to show how maintaining complex Crossplane Compositions is more manageable using <strong>YTT</strong>.</li> <li><strong>Compare Crossplane to Cloud Controllers</strong>: Each major public cloud provider has their Kubernetes Controller for managing resources in their respective cloud. We wanted to compare the <em>producer</em> side of things between those packages we did before.</li> </ul> <p>We stuck to the classic example of a PostgreSQL database. Something you can run anywhere in a myriad of ways. So the attention can be on using Crossplane and managing it with <strong>YTT</strong>.</p> <h2 id=crossplane-xrd-compositions>Crossplane XRD &amp; Compositions<a class=headerlink href=#crossplane-xrd-compositions title="Permanent link">&para;</a></h2> <p>At the time of writing, the (Crossplane) package has four implementations, or <strong>Compositions</strong>.</p> <ul> <li><strong>Helm</strong></li> <li><strong>FlexibleServer</strong> for Azure</li> <li><strong>RDS Private</strong> for AWS, only privately (within VPC) available</li> <li><strong>RDS Public</strong> for AWS, public available</li> </ul> <p>While there is significant overlap between these packages, there are also a lot of differences.</p> <p>This means the case of <strong><em>"I want to run a PostgreSQL database; I don't care where or how"</em></strong> is easily supported. The package ensures sane defaults for every runtime environment for trivial (or hello world) installations.</p> <p>Unfortunately, for anything more complex, the configuration of the public clouds shatters the illusion of a single API (the Crossplane XRD). You cannot use this package for managing databases for non-trivial applications running in production.</p> <p>Still, it serves its purpose of showing the Multicloud potential, the power of YTT, and how Crossplane compares to the cloud-specific controllers.</p> <h3 id=solving-for-random-password>Solving For Random Password<a class=headerlink href=#solving-for-random-password title="Permanent link">&para;</a></h3> <p>An interesting problem encountered early was the need for a secure admin password.</p> <p>There are various ways of generating a password in Kubernetes, for instance, our own <a href=https://github.com/vmware-tanzu/carvel-secretgen-controller/blob/develop/docs/secret-template.md>SecretGen Controller</a>.</p> <p>The challenge is that we need the following:</p> <ul> <li>deterministic name of the secret the password is stored in</li> <li>password is stored in the <strong>ConnectionDetails</strong> secret</li> </ul> <p>Most alternatives, such as the <strong>SecretGen Controller</strong>, do not expose the password so we can get it into the <strong>ConnectionDetails</strong>.</p> <p>Our current solution is the use of <strong>Terraform</strong>. There is an official <strong>Terraform</strong> Provider, and <strong>Terraform</strong> can generate a random password.</p> <p>The Terraform Provider also supports <strong><em>outputs</em></strong>, which the Crossplane uses as values for the <strong>ConnectionSecret</strong>. We can then promote this value to the <strong>ConnectionDetails</strong>.</p> <p>Below is the snippet showing the example. The <strong>Patches</strong> part is cut; we'll dive into that next.</p> <details class=example> <summary>Terraform Password snippet</summary> <div class=highlight><pre><span></span><code><span class=nt>base</span><span class=p>:</span>
<span class=w>  </span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">tf.upbound.io/v1beta1</span>
<span class=w>  </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Workspace</span>
<span class=w>  </span><span class=nt>spec</span><span class=p>:</span>
<span class=w>    </span><span class=nt>forProvider</span><span class=p>:</span>
<span class=w>      </span><span class=nt>module</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
<span class=w>        </span><span class=no>resource &quot;random_password&quot; &quot;password&quot; {</span>
<span class=w>          </span><span class=no>length  = 64</span>
<span class=w>          </span><span class=no>special = false</span>
<span class=w>        </span><span class=no>}</span>

<span class=w>        </span><span class=no>output &quot;password&quot; {</span>
<span class=w>          </span><span class=no>value     = random_password.password.result</span>
<span class=w>          </span><span class=no>sensitive = true</span>
<span class=w>        </span><span class=no>}</span>
<span class=w>      </span><span class=nt>source</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Inline</span>
<span class=w>    </span><span class=nt>writeConnectionSecretToRef</span><span class=p>:</span>
<span class=w>      </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=c1>#@ crossplaneNamespace</span>
<span class=nt>connectionDetails</span><span class=p>:</span>
<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>fromConnectionSecretKey</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">password</span>
</code></pre></div> </details> <h3 id=creating-a-complete-connectiondetails-secret>Creating a complete ConnectionDetails secret<a class=headerlink href=#creating-a-complete-connectiondetails-secret title="Permanent link">&para;</a></h3> <p>We use Crossplane to create and manage data stores in public cloud infrastructure. To consume these data stores with <strong>Tanzu Application Platform</strong> (TAP), we use the <strong>ServiceBinding</strong> and a <em>mapping</em> solution with the <strong>ServicesToolkit</strong> (STK).</p> <p>The <strong>ServiceBinding</strong> spec gives us a clear goal of what we need to generate. We need a secret with specific keys depending on the data store type, e.g., Postgres.</p> <div class="admonition info"> <p class=admonition-title>Postgres required keys</p> <p>The <a href=https://servicebinding.io/ >Service Binding specification</a> defines how a service such as PostgreSQL can be bound to an application.</p> <p>For a list of keys that is required, one can also look at the <a href=https://github.com/spring-cloud/spring-cloud-binding>Spring Cloud Bindings</a> (Java) library.</p> <p>You can view the list for <a href=https://github.com/spring-cloud/spring-cloud-bindings#postgresql-rdbms>PostgreSQL here</a>.</p> </div> <p>For <strong>STK</strong>, we also need some labels on this (Kubernetes) <strong>secret</strong> so it can create a <strong>ClusterInstanceClass</strong>.</p> <p>When using Compositions, Crossplane generates at least two secrets. The data for those secrets depends on the <code>spec.connectionSecretKeys</code> entries in the <strong>CompositeResourceDefinition</strong> (XRD). I will name the secrets to explain this. Both of these secrets represent the <strong>ConnectionDetails</strong> conceptual secret.</p> <ol> <li><strong>Composition Secret</strong>: It creates a "placeholder" secret for collecting the expected entries from the various Composition Resources</li> <li><strong>Claim Secret</strong>: When the Composition has collected all entries, it creates a secret in the namespace of the (Crossplane) <strong>Claim</strong> (e.g., <code>PostgreSQLInstance</code> CR)</li> </ol> <div class="admonition example"> <p class=admonition-title>Instruct Crossplane to create Composition Secret</p> <p>We specify the <code>spec.writeConnectionSecretsToNamespace</code> to instruct Crossplane to create the <em>CompositionSecret</em> and in which namespace.</p> <div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">apiextensions.crossplane.io/v1</span>
<span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Composition</span>
<span class=nt>metadata</span><span class=p>:</span>
<span class=nn>...</span>
<span class=nt>spec</span><span class=p>:</span>
<span class=hll><span class=w>  </span><span class=nt>writeConnectionSecretsToNamespace</span><span class=p>:</span><span class=w> </span><span class=c1>#@ data.values.crossplane.namespace</span>
</span><span class=w>  </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class=w>  </span><span class=nt>resources</span><span class=p>:</span>
</code></pre></div> </div> <p>Some resources defined in the <strong>Composition</strong> have their own <strong>ConnectionSecret</strong>, from where it copies the values to the <strong>ConnectionDetails</strong> secret. An example to illustrate this:</p> <div class="admonition example"> <p class=admonition-title>Terraform Password - Connection Secret</p> <p>The Terraform provider exposes the <code>output</code> in the Module as something Crossplane can write to a <em>ConnectionSecret</em>. We tell Crossplane to create this secret by setting <code>writeConnectionSecretToRef.namespace</code> and <code>writeConnectionSecretToRef.name</code>.</p> <p>We then instruct Crossplane to copy the key <code>password</code> from the <em>ConnectionSecret</em> to the <strong>ConnectionDetails</strong>. Again, the <strong>ConnectionDetails</strong> repre</p> <div class=highlight><pre><span></span><code><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">password</span>
<span class=nt>base</span><span class=p>:</span>
<span class=w>  </span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">tf.upbound.io/v1beta1</span>
<span class=w>  </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Workspace</span>
<span class=w>  </span><span class=nt>spec</span><span class=p>:</span>
<span class=w>    </span><span class=nt>forProvider</span><span class=p>:</span>
<span class=w>      </span><span class=nt>module</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
<span class=w>        </span><span class=no>resource &quot;random_password&quot; &quot;password&quot; {</span>
<span class=w>          </span><span class=no>length  = 64</span>
<span class=w>          </span><span class=no>special = false</span>
<span class=w>        </span><span class=no>}</span>

<span class=hll><span class=w>        </span><span class=no>output &quot;password&quot; {</span>
</span><span class=w>          </span><span class=no>value     = random_password.password.result</span>
<span class=w>          </span><span class=no>sensitive = true</span>
<span class=w>        </span><span class=no>}</span>
<span class=w>      </span><span class=nt>source</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Inline</span>
<span class=hll><span class=w>    </span><span class=nt>writeConnectionSecretToRef</span><span class=p>:</span>
</span><span class=hll><span class=w>      </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=c1>#@ crossplaneNamespace </span>
</span><span class=w>      </span><span class=c1># we set the name in a patch, excluded from the example for brevity</span>
<span class=w>    </span><span class=nt>patches</span><span class=p>:</span>
<span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class=hll><span class=w>    </span><span class=nt>connectionDetails</span><span class=p>:</span>
</span><span class=hll><span class=w>     </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>fromConnectionSecretKey</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">password</span>
</span></code></pre></div> </div> <p>Assuming that this Composition succeeds, we end up with three secrets:</p> <ol> <li>Composition Secret</li> <li>Composition Resource Secret (Terraform Password)</li> <li>Claim Secret</li> </ol> <p>Depending on the number of <strong>Composition</strong> <strong><em>Resources</em></strong> that have secrets, we can end up with a whole bunch of them.</p> <p>We decided to use Crossplane's <strong>Patch</strong> system to reduce the number of secrets. We are reducing the proliferation of possibly sensitive data.</p> <p>To re-iterate our main goal: we need a (Kubernetes) <strong><em>Secret</em></strong> with all the data keys for the ServiceBinding specification and labels for the STK mapping. Any other secret is a potential problem, so the fewer, the better.</p> <p>The most straightforward secret to manipulate is the <strong>Composition Secret</strong>. This secret is a placeholder, so it doesn't impact anything.</p> <div class="admonition example"> <p class=admonition-title>Terraform Password - Modifying Composition Secret</p> <p>We use Crossplane's <em>patches</em> mechanism to "merge" the <strong>Composition Secret</strong> into the <strong>Claim Secret</strong>.</p> <p>This is done by taking the <strong>Claim's</strong> <em>name</em> and <em>namespace</em> and overriding the <code>spec.writeConnectionSecretToRef</code> fields of the Composition. You access these fields via <code>- type: ToCompositeFieldPath</code>.</p> <div class=highlight><pre><span></span><code><span class=nt>patches</span><span class=p>:</span>
<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ToCompositeFieldPath</span>
<span class=w>  </span><span class=nt>fromFieldPath</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">metadata.labels[crossplane.io/claim-name]</span>
<span class=w>  </span><span class=nt>toFieldPath</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">spec.writeConnectionSecretToRef.name</span>
<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ToCompositeFieldPath</span>
<span class=w>  </span><span class=nt>fromFieldPath</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">metadata.labels[crossplane.io/claim-namespace]</span>
<span class=w>  </span><span class=nt>toFieldPath</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">spec.writeConnectionSecretToRef.namespace</span>
</code></pre></div> </div> <p>The <strong>Composition</strong> does not own all Secrets. It can only merge secrets it owns. If you try to merge a secret it doesn't own; you will get an error (in the resource's events) saying it cannot update the secret because it doesn't own it.</p> <p>An example of this is the <strong>Connection Secret</strong> of the <strong>Terraform Password</strong> resource. To help understand what this secret is, we patch it.</p> <div class="admonition example"> <p class=admonition-title>Terraform Password - Rename Connection Secret</p> <p>Here we patch the name of the <strong>Connection Secret</strong> to use the <strong><em>UID</em></strong> of the <strong>Composition</strong>.</p> <p>In addition, we use the <code>transforms</code> option to <em>add</em> further information to the name. This helps us understand what this Secret is and to what resource it belongs.</p> <div class=highlight><pre><span></span><code><span class=nt>patches</span><span class=p>:</span>
<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">FromCompositeFieldPath</span>
<span class=w>  </span><span class=nt>fromFieldPath</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">metadata.uid</span>
<span class=w>  </span><span class=nt>toFieldPath</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">spec.writeConnectionSecretToRef.name</span>
<span class=w>  </span><span class=nt>transforms</span><span class=p>:</span>
<span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">string</span>
<span class=w>      </span><span class=nt>string</span><span class=p>:</span>
<span class=w>        </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Format</span>
<span class=w>        </span><span class=nt>fmt</span><span class=p>:</span><span class=w> </span><span class=s>&#39;%s-postgresql-admin&#39;</span>
</code></pre></div> </div> <h3 id=solve-for-stk-metadata>Solve For STK Metadata<a class=headerlink href=#solve-for-stk-metadata title="Permanent link">&para;</a></h3> <p>The <strong>Claim Secret</strong> we end up with has all the data we write to the <strong>Connection Details</strong>. It has the name of the Claim and exists in the Claim namespace.</p> <p>This is enough for any application to use and leverage with a service binding library (e.g., Spring applications). Unfortunately, this (Kubernetes) secret is relatively sterile, containing no Annotations or Labels.</p> <p>The <strong>Services Toolkit</strong> (STK) needs specific fields or labels on the object to map it to a <strong>ClusterInstanceClass</strong>. We need <strong>ClusterInstanceClasses</strong>, to create <strong>STK Claims</strong> which <strong>TAP</strong> can consume.</p> <p>There are several ways we can tackle this.</p> <ul> <li>Use a <strong>SecretGen Controller's</strong> <strong><em>SecretTemplate</em></strong> to create a copy <em>with</em> the desired labels</li> <li>Specify the labels in the <strong>Crossplane Claim</strong> (see below)</li> <li>Create a <strong>Crossplane</strong> <strong><em>Managed Resource</em></strong> that merges with the <strong>Claim Secret</strong>, adding the desired labels</li> </ul> <p>The first solution is out, as we want fewer secrets, not more.</p> <p>The second solution is not nice for our users, as it requires additional work and understanding. We prefer to use our packages to reduce our users' burden (and cognitive load), not increase it.</p> <div class="admonition example"> <p class=admonition-title>Add labels via Crossplane Claim</p> <p>Here's an example of adding additional metadata to the <strong>Claim Secret</strong>.</p> <div class=highlight><pre><span></span><code><span class=nt>publishConnectionDetailsTo</span><span class=p>:</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">trp-cosmosdb-mongo-bindable-08</span>
<span class=w>  </span><span class=nt>configRef</span><span class=p>:</span>
<span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
<span class=w>  </span><span class=nt>metadata</span><span class=p>:</span>
<span class=w>    </span><span class=nt>labels</span><span class=p>:</span>
<span class=w>      </span><span class=nt>services.apps.tanzu.vmware.com/class</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">azure-mongodb</span>
</code></pre></div> </div> <p>Consequently, there is only one option we like. We create another Crossplane Composition <strong>Resource</strong>.</p> <div class="admonition example"> <p class=admonition-title>Secret with labels resource</p> <p>As you can see, we use the <strong>Crossplane Kubernetes</strong> Provider to create a Kubernetes <strong>Secret</strong> resource.</p> <p>This secret is an empty shell, as we set <code>spec: {}</code>. We do add our labels and patch the name and namespace.</p> <p>We set the <strong><em>name</em></strong> and <strong><em>namespace</em></strong> to the values of the <strong>Claim</strong>. Which guarantees it has the same values as the <strong>Claim Secret</strong>.</p> <p><strong>Crossplane</strong> merges this <em>empty secret</em> with the <strong>Claim Secret</strong>. And thus, our <strong>Claim Secret</strong> ends up having our desired labels.</p> <div class=highlight><pre><span></span><code><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">connectionSecret</span>
<span class=nt>base</span><span class=p>:</span>
<span class=w>  </span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes.crossplane.io/v1alpha1</span>
<span class=w>  </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Object</span>
<span class=w>  </span><span class=nt>spec</span><span class=p>:</span>
<span class=w>    </span><span class=nt>forProvider</span><span class=p>:</span>
<span class=w>      </span><span class=nt>manifest</span><span class=p>:</span>
<span class=w>        </span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class=w>        </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Secret</span>
<span class=w>        </span><span class=nt>spec</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">{}</span>
<span class=w>        </span><span class=nt>metadata</span><span class=p>:</span>
<span class=w>          </span><span class=nt>labels</span><span class=p>:</span>
<span class=w>            </span><span class=nt>services.apps.tanzu.vmware.com/class</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">multicloud-psql</span>
<span class=nt>patches</span><span class=p>:</span>
<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">FromCompositeFieldPath</span>
<span class=w>  </span><span class=nt>fromFieldPath</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">metadata.labels[crossplane.io/claim-name]</span>
<span class=w>  </span><span class=nt>toFieldPath</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">spec.forProvider.manifest.metadata.name</span>
<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">FromCompositeFieldPath</span>
<span class=w>  </span><span class=nt>fromFieldPath</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">metadata.labels[crossplane.io/claim-namespace]</span>
<span class=w>  </span><span class=nt>toFieldPath</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">spec.forProvider.manifest.metadata.namespace</span>
</code></pre></div> </div> <p>More than a single label is required to achieve what we want with the STK. Ideally, we have several dynamic labels to differentiate between different implementations.</p> <p>For example, we would like an infrastructure label to create <strong>ClusterInstanceClasses</strong> for Azure and AWS. This leads us to the next topic we want to explain: how do we manage multiple Compositions with significant overlap?</p> <h2 id=manage-compositions-with-ytt>Manage Compositions with YTT<a class=headerlink href=#manage-compositions-with-ytt title="Permanent link">&para;</a></h2> <p>The four <strong>Compositions</strong> share several resources. Some are the same (e.g., the Terraform Password), while others have minor variations.</p> <p>Let's explain how we tackled the shared values with <strong>YTT</strong> templating.</p> <h3 id=templating>Templating<a class=headerlink href=#templating title="Permanent link">&para;</a></h3> <p>For more information on YTT, <a href=https://carvel.dev/ytt/docs/v0.44.0/ >read the docs</a> or look at the <a href=https://carvel.dev/ytt/#playground>Playground</a>.</p> <p>In contrast to tools such as Helm and Kustomize, <strong>YTT</strong> works with the YAML structure. This means we can create a schema and validate the data we are working with (more on that in the next paragraph).</p> <p>We'll stick to the base templating in this package (and later the Library feature).</p> <p>For the most part, we stick to templating from direct <em>data values</em>. These data values come from input into the templating process.</p> <p>You can supply these in several ways:</p> <ul> <li>data values file</li> <li>raw YAML file</li> <li>a schema file's default values (see next paragraph)</li> <li>input flags when executing the YTT CLI's template command</li> </ul> <p>We supply all our values with a schema file. When we run the <strong>YTT</strong> templating, we use the values from the Schema file and apply the same value to all the templates.</p> <p>The templates we have are the <strong>XRD</strong> and the <strong>Compositions</strong>, each in their respective file.</p> <p>Below are two snippets as examples.</p> <div class="admonition example"> <p class=admonition-title>XRD template snippet</p> <p>The <strong><em>CompositeResourceDefinition</em></strong> or <strong>XRD</strong>. It defines our custom resources and the API for all our compositions.</p> <div class=highlight><pre><span></span><code><span class=c1>#@ load(&quot;@ytt:data&quot;, &quot;data&quot;)</span>
<span class=nn>---</span>
<span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">apiextensions.crossplane.io/v1</span>
<span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">CompositeResourceDefinition</span>
<span class=nt>metadata</span><span class=p>:</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=c1>#@ data.values.xrd.names.plural + &quot;.&quot; + data.values.xrd.group</span>
<span class=nt>spec</span><span class=p>:</span>
<span class=w>  </span><span class=nt>group</span><span class=p>:</span><span class=w> </span><span class=c1>#@ data.values.xrd.group</span>
<span class=w>  </span><span class=nt>names</span><span class=p>:</span><span class=w> </span><span class=c1>#@ data.values.xrd.names</span>
<span class=w>  </span><span class=nt>claimNames</span><span class=p>:</span><span class=w> </span><span class=c1>#@ data.values.xrd.claimNames</span>
</code></pre></div> </div> <div class="admonition example"> <p class=admonition-title>Composition (Helm) template snippet</p> <p>The example below is the top section of the Helm <strong>Composition</strong>.</p> <p>It implements the API defined by the <strong>XRD</strong>. Via the reuse of the same data values, we guarantee it is always correct. And due to the reuse, we specify these fundamental values only once.</p> <div class=highlight><pre><span></span><code><span class=c1>#@ load(&quot;@ytt:data&quot;, &quot;data&quot;)</span>
<span class=nn>---</span>
<span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">apiextensions.crossplane.io/v1</span>
<span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Composition</span>
<span class=nt>metadata</span><span class=p>:</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=c1>#@ data.values.providers.helm.name + &quot;-&quot; + data.values.cloudServiceBindingType</span>
<span class=w>  </span><span class=nt>labels</span><span class=p>:</span>
<span class=w>    </span><span class=nt>crossplane.io/xrd</span><span class=p>:</span><span class=w> </span><span class=c1>#@ data.values.xrd.names.plural + &quot;.&quot; + data.values.xrd.group</span>
<span class=w>    </span><span class=nt>provider</span><span class=p>:</span><span class=w> </span><span class=c1>#@ data.values.providers.helm.name</span>
<span class=w>    </span><span class=nt>database</span><span class=p>:</span><span class=w> </span><span class=c1>#@ data.values.cloudServiceBindingType</span>
<span class=nt>spec</span><span class=p>:</span>
<span class=w>  </span><span class=nt>writeConnectionSecretsToNamespace</span><span class=p>:</span><span class=w> </span><span class=c1>#@ data.values.crossplane.namespace</span>
<span class=w>  </span><span class=nt>compositeTypeRef</span><span class=p>:</span>
<span class=w>    </span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=c1>#@ data.values.xrd.group + &quot;/&quot; + data.values.xrd.version</span>
<span class=w>    </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=c1>#@ data.values.xrd.names.kind</span>
</code></pre></div> </div> <p>Now that you've seen how we reuse the data values, it is good to see where we define the structure and default values.</p> <p>We do so in a <strong><em>Values Schema</em></strong>.</p> <h3 id=schema>Schema<a class=headerlink href=#schema title="Permanent link">&para;</a></h3> <p>In this <strong><em>Values Schema</em></strong>, we define the structure of the data values used by the YTT templating.</p> <p>We need to specify the keys; the values are optional. There are two reasons to specify the values:</p> <ol> <li>to clarify the data type, although for Strings, <code>""</code> will do</li> <li>to set a default value</li> </ol> <div class="admonition example"> <p class=admonition-title>values-schema.ytt.yml</p> <p>We limited the values for brevity, though this is enough to show what you can do with it.</p> <p>First, we have to let <strong>YTT</strong> know this is a values schema. We do so with <code>#@data/values-schema</code>.</p> <p>Then we provide YAML <strong><em>keys</em></strong> in our desired structure.</p> <p>In our case, we only have String values, and because these are only used to generate the <strong>Crossplane</strong> source files, we only need a little documentation. For all the things you can do with the schema, <a href=https://carvel.dev/ytt/docs/v0.44.0/how-to-write-schema/ >read the docs</a>.</p> <div class=highlight><pre><span></span><code><span class=c1>#@data/values-schema</span>
<span class=nn>---</span>
<span class=nt>xrd</span><span class=p>:</span>
<span class=w>  </span><span class=nt>group</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">multi.ref.services.apps.tanzu.vmware.com</span>
<span class=w>  </span><span class=nt>names</span><span class=p>:</span>
<span class=w>    </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">XPostgreSQLInstance</span>
<span class=w>    </span><span class=nt>plural</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">xpostgresqlinstances</span>
<span class=w>  </span><span class=nt>claimNames</span><span class=p>:</span>
<span class=w>    </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">PostgreSQLInstance</span>
<span class=w>    </span><span class=nt>plural</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgresqlinstances</span>
<span class=w>  </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1alpha1</span>

<span class=nt>providers</span><span class=p>:</span>
<span class=w>  </span><span class=nt>helm</span><span class=p>:</span>
<span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">helm</span>
<span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">xpkg.upbound.io/crossplane-contrib/provider-helm</span>
<span class=w>    </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s>&quot;&gt;=v0.12.0&quot;</span>

<span class=nt>crossplane</span><span class=p>:</span>
<span class=w>  </span><span class=c1>#@schema/title &quot;CrossplaneNamespace&quot;</span>
<span class=w>  </span><span class=c1>#@schema/desc &quot;The namespace where crossplane controller is installed&quot;</span>
<span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">upbound-system</span>
<span class=w>  </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s>&#39;^v1.10&#39;</span>

<span class=c1>#@schema/title &quot;StoreConfig&quot;</span>
<span class=c1>#@schema/desc &quot;Details of the StoreConfig&quot;</span>
<span class=nt>storeConfig</span><span class=p>:</span>
<span class=w>  </span><span class=c1>#@schema/title &quot;StoreConfig Name&quot;</span>
<span class=w>  </span><span class=c1>#@schema/desc &quot;The name of the StoreConfig&quot;</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;default&quot;</span>
</code></pre></div> </div> <h3 id=solving-for-re-usable-snippets>Solving For Re-usable Snippets<a class=headerlink href=#solving-for-re-usable-snippets title="Permanent link">&para;</a></h3> <p>In the templating section, you can see how we reuse values from the schema to avoid duplication and misconfiguration.</p> <p>Even so, the number of shared data structures between the <strong>Compositions</strong> is significant. The solution for the <strong>ConnetionDetails</strong>, for example, is something each <strong>Composition</strong> requires.</p> <p>So there is a need for even more reuse. Not just the data values, but entire data structures, for example, the Composition <strong><em>Resources</em></strong>.</p> <p>For that purpose, we use the <strong>YTT</strong> features <a href=https://carvel.dev/ytt/docs/v0.44.0/lang-ref-load/ >Load</a> and <a href=https://carvel.dev/ytt/docs/v0.44.0/lang-ref-def/ >Functions</a>. It lets you create functions in separate files you import into other YTT files.</p> <div class="admonition info"> <p class=admonition-title>YTT Library</p> <p>We could also have opted to use a <strong>YTT</strong> <a href=https://carvel.dev/ytt/docs/v0.44.0/lang-ref-ytt-library/ >Library</a>.</p> <p>Which does practically the same thing but requires more steps to use. So we opted for the solution below.</p> </div> <p>To use this, we do the following:</p> <ol> <li>Create a file named <code>&lt;name&gt;.lib.yml</code></li> <li>Add <strong><em>Functions</em></strong> in this file that generate the Crossplane Composition Resource snippets</li> <li>Load the file and the desired functions in the YTT <em>data</em> file (a) file starting with <code>#@ load("@ytt:data", "data")</code>)</li> <li>Use the functions as if they are defined in this YTT data file</li> </ol> <p>Let's look at some examples to clarify what we did. First, it's a function in a <em>library</em> module.</p> <div class="admonition example"> <p class=admonition-title>shared.lib.yml</p> <p>For clarity, we removed some lines and highlighted the noteworthy lines.</p> <p>We <strong>start</strong> a function with <code>#@ def &lt;name&gt;(&lt;input parameters&gt;)</code>.</p> <p>We <strong>end</strong> a function with <code>#@ end</code>.</p> <p>We can use any defined input parameters directly by name. We determine the value by the order in which the caller supplies them.</p> <p>In this case, we have one parameter, <code>infra</code>. This lets us create a dynamic label on the secret based on the type of infrastructure the <strong>Composition</strong> implements (e.g., <code>azure</code>, <code>aws</code>, <code>kubernetes</code>).</p> <div class=highlight><span class=filename>shared.lib.yml</span><pre><span></span><code><span class=hll><span class=c1>#@ def labelsForSecret(infra):</span>
</span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">connectionSecret</span>
<span class=nt>base</span><span class=p>:</span>
<span class=w>  </span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes.crossplane.io/v1alpha1</span>
<span class=w>  </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Object</span>
<span class=w>  </span><span class=nt>spec</span><span class=p>:</span>
<span class=w>    </span><span class=nt>forProvider</span><span class=p>:</span>
<span class=w>      </span><span class=nt>manifest</span><span class=p>:</span>
<span class=w>        </span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class=w>        </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Secret</span>
<span class=w>        </span><span class=nt>spec</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">{}</span>
<span class=w>        </span><span class=nt>metadata</span><span class=p>:</span>
<span class=w>          </span><span class=nt>labels</span><span class=p>:</span>
<span class=w>            </span><span class=nt>services.apps.tanzu.vmware.com/class</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">multicloud-psql</span>
<span class=hll><span class=w>            </span><span class=nt>services.apps.tanzu.vmware.com/infra</span><span class=p>:</span><span class=w> </span><span class=c1>#@ infra</span>
</span><span class=nt>patches</span><span class=p>:</span>
<span class=nn>...</span>
<span class=hll><span class=c1>#@ end</span>
</span></code></pre></div> </div> <p>We use the library as follows:</p> <ol> <li>We import it using the <code>#@ load()</code> feature. Using the relative path of the file and the functions we want to use. <div class=highlight><pre><span></span><code><span class=c1>#@ load(&quot;shared.lib.yml&quot;, &quot;labelsForSecret&quot;)</span>
</code></pre></div></li> <li>Then, we call the function where we want its <em>output</em> to be. <div class=highlight><pre><span></span><code><span class=nt>resources</span><span class=p>:</span>
<span class="p p-Indicator">-</span><span class=w> </span><span class=c1>#@ labelsForSecret(&quot;aws&quot;)</span>
</code></pre></div></li> </ol> <div class="admonition important"> <p class=admonition-title>Important</p> <p>By default, a function returns the data structure that it defines.</p> <p>If you want to return a single value, you can do so via the <code>return</code> statement like this:</p> <div class=highlight><pre><span></span><code><span class=c1>#@ def TLSSecretName(domain):</span>
<span class=c1>#@ return str(domain).replace(&quot;.&quot;, &quot;-&quot;) + &quot;-tls&quot;</span>
<span class=c1>#@ end</span>
</code></pre></div> </div> <p>The functions can use everything <strong>YTT</strong> has to offer.</p> <p>This makes it an excellent place to handle specific logic for <strong>Crossplane Compositions</strong>. For example, in the case of the AWS RDS instance, we have private and public variants.</p> <p>This means that while most values for the RDS instance definition are the same, some change if it needs to be public.</p> <div class="admonition example"> <p class=admonition-title>AWS Composition Public/Private Switch</p> <p>When we make the RDS instance publicly available, we need to set <code>spec.forProvider.publiclyAccessible</code> to true.</p> <p>We also need to tell <strong>Crossplan</strong> which <strong><em>SubnetGroup</em></strong> it has to use. When we make the RDS instance public, we create the <strong><em>SubnetGroup</em></strong> ourselves and let <strong>Crossplane</strong> manage the reference:</p> <p><div class=highlight><pre><span></span><code><span class=c1>#@ if/end publiclyAccessible: </span>
<span class=nt>dbSubnetGroupNameSelector</span><span class=p>:</span>
<span class=w>  </span><span class=nt>matchControllerRef</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</code></pre></div> <em>ps. <code>#@ if/end</code> means it does an if/else/end expression for a single line only</em></p> <p>If private, we expect you to supply the name of an existing one. We can use the <code>not</code> keyword to reverse the <code>if/end</code>, so we end up with two variations of the same snippet.</p> <div class=highlight><pre><span></span><code><span class=c1>#@ if/end not publiclyAccessible: </span>
<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">FromCompositeFieldPath</span>
<span class=w>  </span><span class=nt>fromFieldPath</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">spec.parameters.aws.dbSubnetGroupName</span>
<span class=w>  </span><span class=nt>toFieldPath</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">spec.forProvider.dbSubnetGroupName</span>
</code></pre></div> <div class=highlight><span class=filename>aws-composition.lib.yml</span><pre><span></span><code><span class=c1>#@ def rdsInstance(crossplaneNamespace, providerConfigRef, publiclyAccessible):</span>
<span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rdsinstance</span>
<span class=nt>base</span><span class=p>:</span>
<span class=w>  </span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rds.aws.upbound.io/v1beta1</span>
<span class=w>  </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Instance</span>
<span class=w>  </span><span class=nt>spec</span><span class=p>:</span>
<span class=w>    </span><span class=nt>forProvider</span><span class=p>:</span>
<span class=w>      </span><span class=nt>engine</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgres</span>
<span class=w>      </span><span class=nt>instanceClass</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">db.t3.micro</span>
<span class=w>      </span><span class=nt>passwordSecretRef</span><span class=p>:</span><span class=w> </span>
<span class=w>        </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">password</span>
<span class=w>        </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=c1>#@ crossplaneNamespace</span>
<span class=hll><span class=w>      </span><span class=nt>publiclyAccessible</span><span class=p>:</span><span class=w> </span><span class=c1>#@ publiclyAccessible</span>
</span><span class=w>      </span><span class=nt>skipFinalSnapshot</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class=w>      </span><span class=nt>storageEncrypted</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class=w>      </span><span class=nt>allocatedStorage</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class=w>      </span><span class=nt>vpcSecurityGroupIdSelector</span><span class=p>:</span>
<span class=w>        </span><span class=nt>matchControllerRef</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class=hll><span class=w>      </span><span class=c1>#@ if/end publiclyAccessible: </span>
</span><span class=w>      </span><span class=nt>dbSubnetGroupNameSelector</span><span class=p>:</span>
<span class=w>        </span><span class=nt>matchControllerRef</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class=w>    </span><span class=nt>providerConfigRef</span><span class=p>:</span>
<span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=c1>#@ providerConfigRef</span>
<span class=nt>patches</span><span class=p>:</span>
<span class=hll><span class=c1>#@ if/end not publiclyAccessible: </span>
</span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">FromCompositeFieldPath</span>
<span class=w>  </span><span class=nt>fromFieldPath</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">spec.parameters.aws.dbSubnetGroupName</span>
<span class=w>  </span><span class=nt>toFieldPath</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">spec.forProvider.dbSubnetGroupName</span>
<span class=nn>...</span>
<span class=c1>#@ end</span>
</code></pre></div> </div> <p>Let's look at the two AWS examples (private and public) to see how this works out for the <strong>Composition</strong> files.</p> <h4 id=aws-private-example>AWS Private Example<a class=headerlink href=#aws-private-example title="Permanent link">&para;</a></h4> <div class=highlight><span class=filename>aws-composition-private.ytt.yml</span><pre><span></span><code><span class=c1>#@ load(&quot;@ytt:data&quot;, &quot;data&quot;)</span>
<span class=nn>---</span>
<span class=c1>#@ load(&quot;aws-composition.lib.yml&quot;, &quot;rdsInstance&quot;, &quot;securityGroup&quot;, &quot;securityGroupRule&quot;)</span>
<span class=c1>#@ load(&quot;shared.lib.yml&quot;, &quot;labelsForSecret&quot;, &quot;tfProviderConfig&quot;, &quot;tfWorkspace&quot;)</span>

<span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">apiextensions.crossplane.io/v1</span>
<span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Composition</span>
<span class=nt>metadata</span><span class=p>:</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=c1>#@ data.values.providers.aws.name + &quot;-&quot; + data.values.cloudServiceBindingType + &quot;-private&quot;</span>
<span class=w>  </span><span class=nt>labels</span><span class=p>:</span>
<span class=w>    </span><span class=nt>crossplane.io/xrd</span><span class=p>:</span><span class=w> </span><span class=c1>#@ data.values.xrd.names.plural + &quot;.&quot; + data.values.xrd.group</span>
<span class=w>    </span><span class=nt>provider</span><span class=p>:</span><span class=w> </span><span class=c1>#@ data.values.providers.aws.name</span>
<span class=w>    </span><span class=nt>database</span><span class=p>:</span><span class=w> </span><span class=c1>#@ data.values.cloudServiceBindingType</span>
<span class=w>    </span><span class=nt>connectivity</span><span class=p>:</span><span class=w> </span><span class=s>&quot;private&quot;</span>
<span class=nt>spec</span><span class=p>:</span>
<span class=w>  </span><span class=nt>writeConnectionSecretsToNamespace</span><span class=p>:</span><span class=w> </span><span class=c1>#@ data.values.crossplane.namespace</span>
<span class=w>  </span><span class=nt>compositeTypeRef</span><span class=p>:</span>
<span class=w>    </span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=c1>#@ data.values.xrd.group + &quot;/&quot; + data.values.xrd.version</span>
<span class=w>    </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=c1>#@ data.values.xrd.names.kind</span>
<span class=w>  </span><span class=nt>resources</span><span class=p>:</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=c1>#@ labelsForSecret(&quot;aws&quot;)</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=c1>#@ tfProviderConfig(data.values.crossplane.namespace)</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=c1>#@ tfWorkspace(data.values.crossplane.namespace)</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=c1>#@ rdsInstance(data.values.crossplane.namespace, data.values.providers.aws.configRef, False)</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=c1>#@ securityGroup()</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=c1>#@ securityGroupRule()</span>
</code></pre></div> <h4 id=aws-public-example>AWS Public Example<a class=headerlink href=#aws-public-example title="Permanent link">&para;</a></h4> <div class="admonition info"> <p class=admonition-title>Convenience Variables</p> <p>YTT supports the use of convenience variables.</p> <p>Below you can see we make ample use of them to make the subnet parameters clearer to understand and separate.</p> </div> <div class=highlight><span class=filename>aws-composition-public.ytt.yml</span><pre><span></span><code><span class=c1>#@ load(&quot;@ytt:data&quot;, &quot;data&quot;)</span>
<span class=nn>---</span>
<span class=c1>#@ load(&quot;aws-composition.lib.yml&quot;,  &quot;rdsInstance&quot;, &quot;securityGroup&quot;, &quot;securityGroupRule&quot;, &quot;subnet&quot;, &quot;routeTableAssociation&quot;, &quot;routeTable&quot;, &quot;route&quot;, &quot;subnetGroup&quot;)</span>
<span class=c1>#@ load(&quot;shared.lib.yml&quot;, &quot;labelsForSecret&quot;, &quot;tfProviderConfig&quot;, &quot;tfWorkspace&quot;)</span>

<span class=c1>#@ subnetASuffix = &#39;-a&#39;</span>
<span class=c1>#@ subnetAFormat = &#39;subnet-a-%s&#39;</span>
<span class=c1>#@ availabilityZoneAFormat = &#39;%sa&#39;</span>
<span class=c1>#@ cidrBlockFieldA = &#39;spec.parameters.aws.public.subnetACidrBlock&#39;</span>

<span class=c1>#@ subnetBSuffix = &#39;-b&#39;</span>
<span class=c1>#@ subnetBFormat = &#39;subnet-b-%s&#39;</span>
<span class=c1>#@ availabilityZoneBFormat = &#39;%sb&#39;</span>
<span class=c1>#@ cidrBlockFieldB = &#39;spec.parameters.aws.public.subnetBCidrBlock&#39;</span>

<span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">apiextensions.crossplane.io/v1</span>
<span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Composition</span>
<span class=nt>metadata</span><span class=p>:</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=c1>#@ data.values.providers.aws.name + &quot;-&quot; + data.values.cloudServiceBindingType + &quot;-public&quot;</span>
<span class=w>  </span><span class=nt>labels</span><span class=p>:</span>
<span class=w>    </span><span class=nt>crossplane.io/xrd</span><span class=p>:</span><span class=w> </span><span class=c1>#@ data.values.xrd.names.plural + &quot;.&quot; + data.values.xrd.group</span>
<span class=w>    </span><span class=nt>provider</span><span class=p>:</span><span class=w> </span><span class=c1>#@ data.values.providers.aws.name </span>
<span class=w>    </span><span class=nt>database</span><span class=p>:</span><span class=w> </span><span class=c1>#@ data.values.cloudServiceBindingType</span>
<span class=w>    </span><span class=nt>connectivity</span><span class=p>:</span><span class=w> </span><span class=s>&quot;public&quot;</span>
<span class=nt>spec</span><span class=p>:</span>
<span class=w>  </span><span class=nt>writeConnectionSecretsToNamespace</span><span class=p>:</span><span class=w> </span><span class=c1>#@ data.values.crossplane.namespace</span>
<span class=w>  </span><span class=nt>compositeTypeRef</span><span class=p>:</span>
<span class=w>    </span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=c1>#@ data.values.xrd.group + &quot;/&quot; + data.values.xrd.version</span>
<span class=w>    </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=c1>#@ data.values.xrd.names.kind</span>
<span class=w>  </span><span class=nt>resources</span><span class=p>:</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=c1>#@ labelsForSecret(&quot;aws&quot;)</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=c1>#@ tfProviderConfig(data.values.crossplane.namespace)</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=c1>#@ tfWorkspace(data.values.crossplane.namespace)</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=c1>#@ rdsInstance(data.values.crossplane.namespace, data.values.providers.aws.configRef, True)</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=c1>#@ securityGroup()</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=c1>#@ securityGroupRule()</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=c1>#@ routeTable()</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=c1>#@ subnetGroup()</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=c1>#@ subnet(subnetASuffix, subnetAFormat, availabilityZoneAFormat, cidrBlockFieldA)</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=c1>#@ routeTableAssociation(subnetASuffix, subnetAFormat)</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=c1>#@ subnet(subnetBSuffix, subnetBFormat, availabilityZoneBFormat, cidrBlockFieldB)</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=c1>#@ routeTableAssociation(subnetBSuffix, subnetBFormat)</span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=c1>#@ route(&#39;route-%s&#39;)</span>
</code></pre></div> <hr> <div class=md-source-file> <small> Last update: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_datetime">2023-01-10 16:45:04</span> </small> </div> </article> </div> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2022 VMware </div> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../../../..", "features": ["navigation.tabs", "navigation.instant", "navigation.tabs.sticky", "content.code.annotate"], "search": "../../../../../assets/javascripts/workers/search.db81ec45.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"method": "mike", "provider": "mike"}}</script> <script src=../../../../../assets/javascripts/bundle.6df46069.min.js></script> </body> </html>