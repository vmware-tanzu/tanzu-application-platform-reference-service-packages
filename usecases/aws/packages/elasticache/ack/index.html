<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Site for examples related to service packages implementing service binding spec to be consumed by VMware Tanzu Application Platform"><link href=https://vmware-tanzu.github.io/tanzu-application-platform-reference-service-packages/usecases/aws/packages/elasticache/ack/ rel=canonical><link rel=icon href=../../../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.4.1, mkdocs-material-8.5.7"><title>Consuming AWS Elasticache with ACK - Tanzu Application Platform Reference Service Packages</title><link rel=stylesheet href=../../../../../assets/stylesheets/main.20d9efc8.min.css><link rel=stylesheet href=../../../../../assets/stylesheets/palette.cbb835fc.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Metropolis,Avenir+Next,Helvetica+Neue,Arial,sans-serif:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Metropolis,Avenir Next,Helvetica Neue,Arial,sans-serif";--md-code-font:"JetBrains Mono"}</style><script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary data-md-color-accent> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#prerequisites class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-component=outdated hidden> </div> <header class="md-header md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../../../.. title="Tanzu Application Platform Reference Service Packages" class="md-header__button md-logo" aria-label="Tanzu Application Platform Reference Service Packages" data-md-component=logo> <img src=../../../../../assets/vm-logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Tanzu Application Platform Reference Service Packages </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Consuming AWS Elasticache with ACK </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary data-md-color-accent aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary data-md-color-accent aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/vmware-tanzu/tanzu-application-platform-reference-service-packages title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> vmware-tanzu/tanzu-application-platform-reference-service-packages </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../../../.. class=md-tabs__link> HOME </a> </li> <li class=md-tabs__item> <a href=../../../../../crossplane/ class=md-tabs__link> Crossplane </a> </li> <li class=md-tabs__item> <a href=../../../prerequisites/ class="md-tabs__link md-tabs__link--active"> Use cases </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../../../.. title="Tanzu Application Platform Reference Service Packages" class="md-nav__button md-logo" aria-label="Tanzu Application Platform Reference Service Packages" data-md-component=logo> <img src=../../../../../assets/vm-logo.png alt=logo> </a> Tanzu Application Platform Reference Service Packages </label> <div class=md-nav__source> <a href=https://github.com/vmware-tanzu/tanzu-application-platform-reference-service-packages title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> vmware-tanzu/tanzu-application-platform-reference-service-packages </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../.. class=md-nav__link> HOME </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2> Crossplane <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Crossplane data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Crossplane </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../crossplane/ class=md-nav__link> Install Crossplane </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2_2 type=checkbox id=__nav_2_2> <label class=md-nav__link for=__nav_2_2> Providers <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Providers data-md-level=2> <label class=md-nav__title for=__nav_2_2> <span class="md-nav__icon md-icon"></span> Providers </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../crossplane/providers/aws/ class=md-nav__link> UXP AWS provider </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3> Use cases <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Use cases" data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Use cases </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_1 type=checkbox id=__nav_3_1 checked> <label class=md-nav__link for=__nav_3_1> AWS <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=AWS data-md-level=2> <label class=md-nav__title for=__nav_3_1> <span class="md-nav__icon md-icon"></span> AWS </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_1_1 type=checkbox id=__nav_3_1_1> <label class=md-nav__link for=__nav_3_1_1> Prerequisites <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Prerequisites data-md-level=3> <label class=md-nav__title for=__nav_3_1_1> <span class="md-nav__icon md-icon"></span> Prerequisites </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../prerequisites/ class=md-nav__link> AWS prerequisites </a> </li> <li class=md-nav__item> <a href=../../../prerequisites/eks/ class=md-nav__link> Create an EKS cluster with EBS CSI driver </a> </li> <li class=md-nav__item> <a href=../../../prerequisites/ack/ class=md-nav__link> Install the AWS Controllers for Kubernetes (ACK) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_1_2 type=checkbox id=__nav_3_1_2 checked> <label class=md-nav__link for=__nav_3_1_2> Packages <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Packages data-md-level=3> <label class=md-nav__title for=__nav_3_1_2> <span class="md-nav__icon md-icon"></span> Packages </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_1_2_1 type=checkbox id=__nav_3_1_2_1 checked> <label class=md-nav__link for=__nav_3_1_2_1> Elasticache with ACK <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Elasticache with ACK" data-md-level=4> <label class=md-nav__title for=__nav_3_1_2_1> <span class="md-nav__icon md-icon"></span> Elasticache with ACK </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Consuming AWS Elasticache with ACK <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Consuming AWS Elasticache with ACK </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#prerequisites class=md-nav__link> Prerequisites </a> </li> <li class=md-nav__item> <a href=#create-service-instances-that-are-compatible-with-tanzu-application-platform class=md-nav__link> Create service instances that are compatible with Tanzu Application Platform </a> </li> <li class=md-nav__item> <a href=#create-a-service-instance-class-for-aws-elasticache class=md-nav__link> Create a service instance class for AWS Elasticache </a> </li> <li class=md-nav__item> <a href=#discover-claim-and-bind-to-an-aws-elasticache-for-redis-instance class=md-nav__link> Discover, Claim, and Bind to an AWS Elasticache for Redis instance </a> <nav class=md-nav aria-label="Discover, Claim, and Bind to an AWS Elasticache for Redis instance"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#test-claim-with-tap-workload class=md-nav__link> Test Claim With TAP Workload </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#delete-an-aws-elasticache-service-instance-resources class=md-nav__link> Delete an AWS Elasticache service instance resources </a> <nav class=md-nav aria-label="Delete an AWS Elasticache service instance resources"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#delete-an-aws-elasticache-instance-via-carvel-package class=md-nav__link> Delete an AWS Elasticache instance via Carvel Package </a> </li> <li class=md-nav__item> <a href=#delete-an-aws-elasticache-instance-via-kubectl class=md-nav__link> Delete an AWS Elasticache instance via Kubectl </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=manual/ class=md-nav__link> Creating AWS Elasticache Instances manually using kubectl (experimental) </a> </li> <li class=md-nav__item> <a href=package/ class=md-nav__link> Creating AWS Elasticache instances by using a Carvel package (experimental) </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#prerequisites class=md-nav__link> Prerequisites </a> </li> <li class=md-nav__item> <a href=#create-service-instances-that-are-compatible-with-tanzu-application-platform class=md-nav__link> Create service instances that are compatible with Tanzu Application Platform </a> </li> <li class=md-nav__item> <a href=#create-a-service-instance-class-for-aws-elasticache class=md-nav__link> Create a service instance class for AWS Elasticache </a> </li> <li class=md-nav__item> <a href=#discover-claim-and-bind-to-an-aws-elasticache-for-redis-instance class=md-nav__link> Discover, Claim, and Bind to an AWS Elasticache for Redis instance </a> <nav class=md-nav aria-label="Discover, Claim, and Bind to an AWS Elasticache for Redis instance"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#test-claim-with-tap-workload class=md-nav__link> Test Claim With TAP Workload </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#delete-an-aws-elasticache-service-instance-resources class=md-nav__link> Delete an AWS Elasticache service instance resources </a> <nav class=md-nav aria-label="Delete an AWS Elasticache service instance resources"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#delete-an-aws-elasticache-instance-via-carvel-package class=md-nav__link> Delete an AWS Elasticache instance via Carvel Package </a> </li> <li class=md-nav__item> <a href=#delete-an-aws-elasticache-instance-via-kubectl class=md-nav__link> Delete an AWS Elasticache instance via Kubectl </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1>Consuming AWS Elasticache with ACK</h1> <p>This guide describes using the Services Toolkit to allow Tanzu Application Platform workloads to consume AWS Elasticache. This particular topic makes use of <a href=https://aws-controllers-k8s.github.io/community/docs/community/overview/ >AWS Controller for Kubernetes</a> to manage AWS Elasticache instances.</p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>This usecase is not currently compatible with TAP air-gapped installations.</p> </div> <h2 id=prerequisites>Prerequisites<a class=headerlink href=#prerequisites title="Permanent link">&para;</a></h2> <p>You need to meet a number of <a href=../../../prerequisites/ >prerequisites</a> before being able to effectively follow this guide.</p> <h2 id=create-service-instances-that-are-compatible-with-tanzu-application-platform>Create service instances that are compatible with Tanzu Application Platform<a class=headerlink href=#create-service-instances-that-are-compatible-with-tanzu-application-platform title="Permanent link">&para;</a></h2> <p>The installation of the AWS Elasticache Controller for Kubernetes results in the availability of new Kubernetes APIs for interacting with Elasticache resources from within the TAP cluster.</p> <div class=highlight><pre><span></span><code>kubectl api-resources --api-group elasticache.services.k8s.aws
</code></pre></div> <div class=highlight><pre><span></span><code>NAME                   SHORTNAMES   APIVERSION                              NAMESPACED   KIND
cacheparametergroups                elasticache.services.k8s.aws/v1alpha1   true         CacheParameterGroup
cachesubnetgroups                   elasticache.services.k8s.aws/v1alpha1   true         CacheSubnetGroup
replicationgroups                   elasticache.services.k8s.aws/v1alpha1   true         ReplicationGroup
snapshots                           elasticache.services.k8s.aws/v1alpha1   true         Snapshot
usergroups                          elasticache.services.k8s.aws/v1alpha1   true         UserGroup
users                               elasticache.services.k8s.aws/v1alpha1   true         User
</code></pre></div> <p>To create an AWS Elasticache service instance for consumption by Tanzu Application Platform, you can use a ready-made, reference Carvel Package. The Service Operator typically performs this step. Follow the steps in <a href=package/ >Creating an AWS Elasticache service instance using a Carvel Package</a>.</p> <p>Alternatively, if you are interested in authoring your own Reference Package and want to learn about the underlying APIs and how they come together to produce a useable service instance for the Tanzu Application Platform, you can achieve the same outcome using the more advanced <a href=manual/ >Creating an AWS Elasticache service instance manually</a>.</p> <p>Once you have completed either of these steps and have a running AWS Elasticache service instance, please return here to continue with the rest of the use case.</p> <h2 id=create-a-service-instance-class-for-aws-elasticache>Create a service instance class for AWS Elasticache<a class=headerlink href=#create-a-service-instance-class-for-aws-elasticache title="Permanent link">&para;</a></h2> <p>Now that you know how to create AWS Elasticache instances, it's time to learn how to make those instances discoverable to Application Operators. Again, this step is typically performed by the service operator persona.</p> <p>You can use Services Toolkit's <code>ClusterInstanceClass</code> API to create a service instance class to represent Elasticache service instances within the cluster. The existence of such classes makes these logical service instances discoverable to application operators, thus allowing them to create [Resource Claims][resource-claims] for such instances and to then bind them to application workloads.</p> <p>Create the following Kubernetes resource on your AKS cluster:</p> <div class=highlight><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>clusterinstanceclass.yaml</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nn>---</span><span class=w></span>
<span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">services.apps.tanzu.vmware.com/v1alpha1</span><span class=w></span>
<span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ClusterInstanceClass</span><span class=w></span>
<span class=nt>metadata</span><span class=p>:</span><span class=w></span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">aws-elasticache</span><span class=w></span>
<span class=nt>spec</span><span class=p>:</span><span class=w></span>
<span class=w>  </span><span class=nt>description</span><span class=p>:</span><span class=w></span>
<span class=w>    </span><span class=nt>short</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">AWS Elasticache instances</span><span class=w></span>
<span class=w>  </span><span class=nt>pool</span><span class=p>:</span><span class=w></span>
<span class=w>    </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Secret</span><span class=w></span>
<span class=w>    </span><span class=nt>labelSelector</span><span class=p>:</span><span class=w></span>
<span class=w>      </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w></span>
<span class=w>        </span><span class=nt>services.apps.tanzu.vmware.com/class</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">aws-elasticache</span><span class=w></span>
</code></pre></div></td></tr></table></div> <div class=highlight><pre><span></span><code>kubectl apply -f clusterinstanceclass.yaml
</code></pre></div> <p>In this particular example, the class represents claimable instances of Postgresql by a <code>Secret</code> object with the label <code>services.apps.tanzu.vmware.com/class</code> set to <code>aws-elasticache</code>.</p> <p>In addition, you need to grant sufficient RBAC permissions to Services Toolkit to be able to read the secrets specified by the class. Create the following RBAC on your AKS cluster:</p> <div class=highlight><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>clusterrole.yaml</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nn>---</span><span class=w></span>
<span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span><span class=w></span>
<span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ClusterRole</span><span class=w></span>
<span class=nt>metadata</span><span class=p>:</span><span class=w></span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">stk-secret-reader</span><span class=w></span>
<span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w></span>
<span class=w>    </span><span class=nt>servicebinding.io/controller</span><span class=p>:</span><span class=w> </span><span class=s>&quot;true&quot;</span><span class=w></span>
<span class=nt>rules</span><span class=p>:</span><span class=w></span>
<span class="p p-Indicator">-</span><span class=w> </span><span class=nt>apiGroups</span><span class=p>:</span><span class=w></span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;&quot;</span><span class=w></span>
<span class=w>  </span><span class=nt>resources</span><span class=p>:</span><span class=w></span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">secrets</span><span class=w></span>
<span class=w>  </span><span class=nt>verbs</span><span class=p>:</span><span class=w></span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">get</span><span class=w></span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">list</span><span class=w></span>
<span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">watch</span><span class=w></span>
</code></pre></div></td></tr></table></div> <div class=highlight><pre><span></span><code>kubectl apply -f clusterrole.yaml
</code></pre></div> <p>If you want to claim resources across namespace boundaries, you will have to create a corresponding <code>ResourceClaimPolicy</code>. For example, if the provisioned AWS Elasticache instance named <code>redis</code> exists in namespace <code>service-instances</code> and you want to allow App Operators to claim them for workloads residing in the <code>default</code> namespace, you would have to create the following <code>ResourceClaimPolicy</code>:</p> <div class=highlight><table class=highlighttable><tr><th colspan=2 class=filename><span class=filename>resourceclaimpolicy.yaml</span></th></tr><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span></pre></div></td><td class=code><div><pre><span></span><code><span class=nn>---</span><span class=w></span>
<span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">services.apps.tanzu.vmware.com/v1alpha1</span><span class=w></span>
<span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ResourceClaimPolicy</span><span class=w></span>
<span class=nt>metadata</span><span class=p>:</span><span class=w></span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">default-can-claim-aws-elasticache</span><span class=w></span>
<span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">service-instances</span><span class=w></span>
<span class=nt>spec</span><span class=p>:</span><span class=w></span>
<span class=w>  </span><span class=nt>subject</span><span class=p>:</span><span class=w></span>
<span class=w>    </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Secret</span><span class=w></span>
<span class=w>    </span><span class=nt>group</span><span class=p>:</span><span class=w> </span><span class=s>&quot;&quot;</span><span class=w></span>
<span class=w>    </span><span class=nt>selector</span><span class=p>:</span><span class=w></span>
<span class=w>      </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w></span>
<span class=w>        </span><span class=nt>services.apps.tanzu.vmware.com/class</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">aws-elasticache</span><span class=w></span>
<span class=w>  </span><span class=nt>consumingNamespaces</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=w> </span><span class=s>&quot;default&quot;</span><span class=w> </span><span class="p p-Indicator">]</span><span class=w></span>
</code></pre></div></td></tr></table></div> <div class=highlight><pre><span></span><code>kubectl apply -f resourceclaimpolicy.yaml
</code></pre></div> <h2 id=discover-claim-and-bind-to-an-aws-elasticache-for-redis-instance>Discover, Claim, and Bind to an AWS Elasticache for Redis instance<a class=headerlink href=#discover-claim-and-bind-to-an-aws-elasticache-for-redis-instance title="Permanent link">&para;</a></h2> <p>The act of creating the <code>ClusterInstanceClass</code> and the corresponding RBAC essentially advertises to application operators that AWS Elasticache for Redis is available to use with their application workloads on Tanzu Application Platform. In this section, you learn how to discover, claim, and bind to the AWS Elasticache service instance previously created. Discovery and claiming service instances is typically the responsibility of the application operator persona. Binding is typically a step for Application Developers.</p> <p>To discover what service instances are available to them, application operators can run:</p> <div class=highlight><pre><span></span><code><span class=hll>$ tanzu services classes list
</span>
  NAME             DESCRIPTION
  aws-elasticache  AWS Elasticache instances
</code></pre></div> <p>You can see information about the <code>ClusterInstanceClass</code> created in the previous step. Each <code>ClusterInstanceClass</code> created will be added to the list of classes returned here.</p> <p>The next step is to "claim" an instance of the desired class, but to do that, the application operators must first discover the list of currently claimable instances for the class. The capacity to claim instances is affected by many variables (including namespace boundaries, claim policies, and the exclusivity of claims) and so Services Toolkit provides a CLI command to help inform application operators of the instances that can result in successful claims. This command is the <code>tanzu service claimable list</code> command.</p> <div class=highlight><pre><span></span><code><span class=hll>$ tanzu services claimable list --class aws-elasticache -n default
</span>
  NAME                         NAMESPACE          KIND    APIVERSION
  redis-reader-creds-bindable  service-instances  Secret  v1
  redis-writer-creds-bindable  service-instances  Secret  v1
</code></pre></div> <p>Create a claim for the newly created secret by running:</p> <div class=highlight><pre><span></span><code>tanzu services claim create redis-writer-claim <span class=se>\</span>
  --namespace default <span class=se>\</span>
  --resource-namespace service-instances <span class=se>\</span>
  --resource-name redis-writer-creds-bindable <span class=se>\</span>
  --resource-kind Secret <span class=se>\</span>
  --resource-api-version v1
</code></pre></div> <p>Obtain the claim reference of the claim by running:</p> <div class=highlight><pre><span></span><code><span class=hll>$ tanzu services claim list -o wide
</span>
  NAME                READY  REASON  CLAIM REF
  redis-writer-claim  True   Ready   services.apps.tanzu.vmware.com/v1alpha1:ResourceClaim:redis-writer-claim
</code></pre></div> <h3 id=test-claim-with-tap-workload>Test Claim With TAP Workload<a class=headerlink href=#test-claim-with-tap-workload title="Permanent link">&para;</a></h3> <p>Create an application workload that consumes the claimed AWS Elasticache by running:</p> <p>Example:</p> <div class=highlight><pre><span></span><code>tanzu apps workload create my-workload <span class=se>\</span>
  --git-repo &lt;a-git-repo&gt; <span class=se>\</span>
  --git-tag &lt;a-tag-to-checkout&gt; <span class=se>\</span>
  --type web <span class=se>\</span>
  --annotation autoscaling.knative.dev/minScale<span class=o>=</span><span class=m>1</span> <span class=se>\</span>
  --service-ref <span class=nv>db</span><span class=o>=</span>services.apps.tanzu.vmware.com/v1alpha1:ResourceClaim:redis-writer-claim
</code></pre></div> <p><code>--service-ref</code> is set to the claim reference obtained previously.</p> <p>Your application workload starts and gets automatically the credentials to the AWS Elasticache instance via service bindings.</p> <h2 id=delete-an-aws-elasticache-service-instance-resources>Delete an AWS Elasticache service instance resources<a class=headerlink href=#delete-an-aws-elasticache-service-instance-resources title="Permanent link">&para;</a></h2> <p>To delete the AWS Elasticache service instance, you can run the appropriate cleanup commands for how you created the service.</p> <h3 id=delete-an-aws-elasticache-instance-via-carvel-package>Delete an AWS Elasticache instance via Carvel Package<a class=headerlink href=#delete-an-aws-elasticache-instance-via-carvel-package title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code>tanzu package installed delete redis-instance
</code></pre></div> <h3 id=delete-an-aws-elasticache-instance-via-kubectl>Delete an AWS Elasticache instance via Kubectl<a class=headerlink href=#delete-an-aws-elasticache-instance-via-kubectl title="Permanent link">&para;</a></h3> <p>Delete the AWS Elasticache instance by running:</p> <div class=highlight><pre><span></span><code><span class=go>kubectl delete -n service-instances replicationgroup.elasticache.services.k8s.aws redis</span>
<span class=go>kubectl delete -n service-instances usergroup.elasticache.services.k8s.aws redis</span>
<span class=go>kubectl delete -n service-instances user.elasticache.services.k8s.aws redis-default</span>
<span class=go>kubectl delete -n service-instances user.elasticache.services.k8s.aws redis-reader</span>
<span class=go>kubectl delete -n service-instances user.elasticache.services.k8s.aws redis-writer</span>
<span class=go>kubectl delete -n service-instances cachesubnetgroups.elasticache.services.k8s.aws ack-elasticache</span>
<span class=go>kubectl delete -n service-instances secrettemplate.secretgen.carvel.dev redis-reader-creds-bindable</span>
<span class=go>kubectl delete -n service-instances secrettemplate.secretgen.carvel.dev redis-writer-creds-bindable</span>
<span class=go>kubectl delete -n service-instances password.secretgen.carvel.dev redis-reader-creds</span>
<span class=go>kubectl delete -n service-instances password.secretgen.carvel.dev redis-writer-creds</span>
<span class=go>kubectl delete -n service-instances serviceaccounts redis-elasticache-reader</span>
<span class=go>kubectl delete -n service-instances role redis-elasticache-reader</span>
<span class=go>kubectl delete -n service-instances rolebinding redis-elasticache-reader</span>
</code></pre></div> <!-- 
## AWS Controller for Kubernetes Troubleshooting

Sometimes the AWS Controller for Kubernetes doesn't behave as expected.
You can go through a [troubleshooting guide][si-troubleshooting] to search for help
about the most common scenarios.

[si-troubleshooting]: ./troubleshooting.md
[resource-claims]: https://docs.vmware.com/en/Services-Toolkit-for-VMware-Tanzu-Application-Platform/0.8/svc-tlk/GUID-resource_claims-api_docs.html --> <hr> <div class=md-source-file> <small> Last update: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_datetime">2022-11-05 01:08:19</span> </small> </div> </article> </div> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../../../prerequisites/ack/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Install the AWS Controllers for Kubernetes (ACK)" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> Install the AWS Controllers for Kubernetes (ACK) </div> </div> </a> <a href=manual/ class="md-footer__link md-footer__link--next" aria-label="Next: Creating AWS Elasticache Instances manually using kubectl (experimental)" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Creating AWS Elasticache Instances manually using kubectl (experimental) </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2022 VMware </div> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../../../..", "features": ["navigation.tabs", "navigation.instant", "navigation.tabs.sticky", "content.code.annotate"], "search": "../../../../../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": {"method": "mike", "provider": "mike"}}</script> <script src=../../../../../assets/javascripts/bundle.8492ddcf.min.js></script> </body> </html>